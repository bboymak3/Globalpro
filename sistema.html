<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GlobalPro Taller</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-4">
    <div class="max-w-md mx-auto bg-gray-800 p-6 rounded-lg shadow-xl border-t-4 border-yellow-500">
        <h2 class="text-2xl font-bold text-center text-yellow-500 mb-6">GLOBAL PRO</h2>
        
        <input type="text" id="placa" placeholder="Placa (Obligatorio)" class="w-full p-3 mb-3 bg-gray-700 rounded border border-gray-600 focus:border-yellow-500 outline-none">
        <input type="text" id="nombre" placeholder="Nombre Cliente" class="w-full p-3 mb-3 bg-gray-700 rounded border border-gray-600">
        <input type="text" id="tecnico" placeholder="Técnico" class="w-full p-3 mb-3 bg-gray-700 rounded border border-gray-600">
        <input type="number" id="km" placeholder="Kilometraje" class="w-full p-3 mb-3 bg-gray-700 rounded border border-gray-600">
        <textarea id="notas" placeholder="Notas..." class="w-full p-3 mb-4 bg-gray-700 rounded border border-gray-600 h-24"></textarea>
        
        <button onclick="guardar()" id="btn" class="w-full bg-yellow-500 text-black font-bold py-3 rounded hover:bg-yellow-400">GUARDAR</button>
    </div>

    <script>
        // ESTA ES LA URL DIRECTA AL CEREBRO
        const API_URL = "https://taller.estilosgrado33.workers.dev";

        async function guardar() {
            const btn = document.getElementById('btn');
            const data = {
                placa: document.getElementById('placa').value,
                nombre_usuario: document.getElementById('nombre').value,
                tecnico: document.getElementById('tecnico').value,
                km: document.getElementById('km').value,
                notas: document.getElementById('notas').value
            };

            if(!data.placa) return alert("Pon la placa");
            btn.disabled = true; btn.innerText = "ENVIANDO...";

            try {
                // Usamos la URL directa para evitar que Pages se meta en el medio
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if(res.ok) {
                    alert("✅ Guardado con éxito");
                    location.reload();
                } else {
                    alert("❌ Error en el servidor");
                }
            } catch(e) {
                alert("❌ Error de red: " + e.message);
            } finally {
                btn.disabled = false; btn.innerText = "GUARDAR";
            }
        }
    </script>
</body>
</html>